rm -rf WINNT5.1_OPT.OBJ
# This first make fails but generates a file that will make allow run of same command to work
make BUILD_OPT=1 JS_DIST=/mingw64 JS_THREADSAFE=1 -fMakefile.ref -j16
echo "Continuing build after first make failure..."
# This second make runs until linking then fails
make BUILD_OPT=1 JS_DIST=/mingw64 JS_THREADSAFE=1 -fMakefile.ref -j16
echo "Continuing build after link failure..."
set -x
as -o WINNT5.1_OPT.OBJ/methodjit/TrampolinemingwX64.o -mtune=generic64 methodjit/TrampolinemingwX64.s
g++ -shared -Wl,--out-implib,WINNT5.1_OPT.OBJ/libjs32ECMAv5.dll.a -DXP_WIN -DEXPORT_JS_API -DJS_C_STRINGS_ARE_UTF8 -D_WINDOWS -DWINVER=0x500 -D_WIN32_WINNT=0x500   -UDEBUG -DNDEBUG -UDEBUG_ -DJS_TRACER -DFEATURE_NANOJIT -DAVMPLUS_64BIT -DAVMPLUS_AMD64 -DJS_CPU_X64 -DJS_PUNBOX64 -DENABLE_ASSEMBLER -DJS_METHODJIT=1 -DJS_MONOIC=1 -DJS_POLYIC=1 -DMOZ_TRACE_JSCALLS=1 -O2 -mtune=generic -o WINNT5.1_OPT.OBJ/js32ECMAv5.dll WINNT5.1_OPT.OBJ/jsanalyze.o WINNT5.1_OPT.OBJ/jsapi.o WINNT5.1_OPT.OBJ/jsarena.o WINNT5.1_OPT.OBJ/jsarray.o WINNT5.1_OPT.OBJ/jsatom.o WINNT5.1_OPT.OBJ/jsbool.o WINNT5.1_OPT.OBJ/jsclone.o WINNT5.1_OPT.OBJ/jscntxt.o WINNT5.1_OPT.OBJ/jscompartment.o WINNT5.1_OPT.OBJ/jsdate.o WINNT5.1_OPT.OBJ/jsdbgapi.o WINNT5.1_OPT.OBJ/jsdhash.o WINNT5.1_OPT.OBJ/jsdtoa.o WINNT5.1_OPT.OBJ/jsemit.o WINNT5.1_OPT.OBJ/jsexn.o WINNT5.1_OPT.OBJ/jsfun.o WINNT5.1_OPT.OBJ/jsgc.o WINNT5.1_OPT.OBJ/jsgcchunk.o WINNT5.1_OPT.OBJ/jsgcstats.o WINNT5.1_OPT.OBJ/jshash.o WINNT5.1_OPT.OBJ/jsinterp.o WINNT5.1_OPT.OBJ/jsinvoke.o WINNT5.1_OPT.OBJ/jsiter.o WINNT5.1_OPT.OBJ/jslock.o WINNT5.1_OPT.OBJ/jslog2.o WINNT5.1_OPT.OBJ/jsmath.o WINNT5.1_OPT.OBJ/jsnativestack.o WINNT5.1_OPT.OBJ/jsnum.o WINNT5.1_OPT.OBJ/jsobj.o WINNT5.1_OPT.OBJ/json.o WINNT5.1_OPT.OBJ/jsopcode.o WINNT5.1_OPT.OBJ/jsparse.o WINNT5.1_OPT.OBJ/jsprf.o WINNT5.1_OPT.OBJ/jsprobes.o WINNT5.1_OPT.OBJ/jspropertycache.o WINNT5.1_OPT.OBJ/jspropertytree.o WINNT5.1_OPT.OBJ/jsproxy.o WINNT5.1_OPT.OBJ/jsreflect.o WINNT5.1_OPT.OBJ/jsregexp.o WINNT5.1_OPT.OBJ/jsscan.o WINNT5.1_OPT.OBJ/jsscope.o WINNT5.1_OPT.OBJ/jsscript.o WINNT5.1_OPT.OBJ/jsstr.o WINNT5.1_OPT.OBJ/jstypedarray.o WINNT5.1_OPT.OBJ/jsutil.o WINNT5.1_OPT.OBJ/jswrapper.o WINNT5.1_OPT.OBJ/jsxdrapi.o WINNT5.1_OPT.OBJ/jsxml.o WINNT5.1_OPT.OBJ/prmjtime.o WINNT5.1_OPT.OBJ/jsbuiltins.o WINNT5.1_OPT.OBJ/jstracer.o WINNT5.1_OPT.OBJ/nanojit/Allocator.o WINNT5.1_OPT.OBJ/nanojit/Assembler.o WINNT5.1_OPT.OBJ/nanojit/CodeAlloc.o WINNT5.1_OPT.OBJ/nanojit/Containers.o WINNT5.1_OPT.OBJ/nanojit/Fragmento.o WINNT5.1_OPT.OBJ/nanojit/LIR.o WINNT5.1_OPT.OBJ/nanojit/NativeX64.o WINNT5.1_OPT.OBJ/nanojit/njconfig.o WINNT5.1_OPT.OBJ/nanojit/RegAlloc.o WINNT5.1_OPT.OBJ/nanojit/avmplus.o WINNT5.1_OPT.OBJ/nanojit/VMPI.o WINNT5.1_OPT.OBJ/tracejit/Writer.o WINNT5.1_OPT.OBJ/assembler/jit/ExecutableAllocator.o WINNT5.1_OPT.OBJ/assembler/jit/ExecutableAllocatorWin.o WINNT5.1_OPT.OBJ/yarr/pcre/pcre_exec.o WINNT5.1_OPT.OBJ/yarr/pcre/pcre_xclass.o WINNT5.1_OPT.OBJ/yarr/pcre/pcre_tables.o WINNT5.1_OPT.OBJ/yarr/pcre/pcre_compile.o WINNT5.1_OPT.OBJ/yarr/pcre/pcre_ucp_searchfuncs.o WINNT5.1_OPT.OBJ/yarr/yarr/RegexCompiler.o WINNT5.1_OPT.OBJ/yarr/yarr/RegexJIT.o WINNT5.1_OPT.OBJ/assembler/assembler/MacroAssemblerX86Common.o WINNT5.1_OPT.OBJ/assembler/wtf/Assertions.o WINNT5.1_OPT.OBJ/v8-dtoa/checks.o WINNT5.1_OPT.OBJ/v8-dtoa/conversions.o WINNT5.1_OPT.OBJ/v8-dtoa/diy-fp.o WINNT5.1_OPT.OBJ/v8-dtoa/fast-dtoa.o WINNT5.1_OPT.OBJ/v8-dtoa/platform.o WINNT5.1_OPT.OBJ/v8-dtoa/utils.o WINNT5.1_OPT.OBJ/v8-dtoa/v8-dtoa.o WINNT5.1_OPT.OBJ/methodjit/Compiler.o WINNT5.1_OPT.OBJ/methodjit/FastArithmetic.o WINNT5.1_OPT.OBJ/methodjit/FastOps.o WINNT5.1_OPT.OBJ/methodjit/FrameState.o WINNT5.1_OPT.OBJ/methodjit/ImmutableSync.o WINNT5.1_OPT.OBJ/methodjit/InvokeHelpers.o WINNT5.1_OPT.OBJ/methodjit/Logging.o WINNT5.1_OPT.OBJ/methodjit/MethodJIT.o WINNT5.1_OPT.OBJ/methodjit/MonoIC.o WINNT5.1_OPT.OBJ/methodjit/PolyIC.o WINNT5.1_OPT.OBJ/methodjit/Retcon.o WINNT5.1_OPT.OBJ/methodjit/StubCalls.o WINNT5.1_OPT.OBJ/methodjit/StubCompiler.o WINNT5.1_OPT.OBJ/methodjit/TrampolineCompiler.o WINNT5.1_OPT.OBJ/methodjit/TrampolinemingwX64.o -lnspr4 -lkernel32 -luser32 -lgdi32 -lwinmm -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -luuid
if [ $? -eq 0 ]; then
	echo "JavaScript release build succeeded"
else
	echo "JavaScript release build failed"
fi

